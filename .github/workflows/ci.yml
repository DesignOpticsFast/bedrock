name: CI

on:
  push:
    branches: [ "main" ]
    tags: [ "v*" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read
  security-events: write

jobs:
  build:                       # keep this id so the check stays "CI / build"
    name: Ubuntu build (with OpenCascade)
    runs-on: ubuntu-24.04

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install deps (toolchain + OpenCascade)
        run: |
          sudo apt-get update
          sudo apt-get install -y cmake ninja-build g++ \
            libocct-foundation-dev libocct-modeling-data-dev \
            libocct-modeling-algorithms-dev libocct-ocaf-dev \
            libocct-visualization-dev libocct-data-exchange-dev

      - name: Configure (CMake + OCCT)
        run: |
          export OpenCASCADE_DIR=/usr/lib/x86_64-linux-gnu/cmake/opencascade
          cmake -S . -B build -G Ninja \
            -DCMAKE_BUILD_TYPE=Release \
            -DOpenCASCADE_DIR="${OpenCASCADE_DIR}"

      - name: Build
        run: cmake --build build --config Release -j

      # keep only if you actually have ctest tests; otherwise omit
      - name: Run tests (ctest)
        if: ${{ always() }}
        run: ctest --test-dir build --output-on-failure || true
